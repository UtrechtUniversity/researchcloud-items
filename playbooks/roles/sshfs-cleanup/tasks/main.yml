---
# make sure the role sshfs_configrobot has been called prior to this role and in the SAME playbook
# so that variable sshfs_connection_info is still available here

- name: Execute the tasks (non-idempotent)
  tags: molecule-idempotence-notest
  block:

  - name: Wait until mounted filesystem is at rest
    command: sync

  - name: Umount remote filesystem
    mount:
      path: "{{ sshfs_connection_info.mountpoint }}"
      state: unmounted

  - name: Cleanup robotuser
    user:
      name: "{{ robotuser_name }}"
      state: absent
      remove: true
      force: true
