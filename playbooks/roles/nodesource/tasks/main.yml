---
- name: Download nodesource key
  ansible.builtin.get_url:
    url: https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key
    dest: "{{ nodesource_key_location }}"
    mode: "0644"

- name: Add nodesource repository for apt package manager
  ansible.builtin.apt_repository:
    repo: deb [arch={{ nodesource_arch }}, signed-by={{ nodesource_key_location }}] {{ nodesource_repo }} nodistro main
    state: present
    filename: nodesource

- name: Set preferences
  ansible.builtin.copy:
    dest: /etc/apt/preferences.d/nodejs
    content: >
      Package: nodejs
      Pin: origin deb.nodesource.com"
      Pin-Priority: 600
    owner: root
    group: root
    mode: "0644"

- name: Install NodeJS
  ansible.builtin.apt:
    name:
      - nodejs
    state: present
    update_cache: true
