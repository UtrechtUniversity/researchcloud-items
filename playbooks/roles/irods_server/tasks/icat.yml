---
- name: prepare psql script
  template:
    src: "create_icat.sql.j2"
    dest: "/tmp/create_icat.sql"
    owner: postgres
    group: postgres
    mode: 0700

- name: Create irods db user and ICAT database, if they do not yet exist, using psql
  command: psql /tmp/create_icat.sql

- name: cleanup psql script
  file:
    path: /tmp/create_icat.sql
    state: absent

