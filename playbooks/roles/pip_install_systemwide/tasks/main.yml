---
- name: Add custom systemwide pip path to each user's path for installing global packages.
  when: pip_install_systemwide_profile | length > 0
  copy:
    dest: "/etc/profile.d/{{ pip_install_systemwide_profile }}"
    content: |
      export PYTHONPATH="{{ pip_install_systemwide_location }}${PYTHONPATH:+:${PYTHONPATH}}"
      export PATH="{{ pip_install_systemwide_location }}/bin${PATH:+:${PATH}}"

- name: Install packages
  pip:
    name: "{{ item }}"
    extra_args: "--target {{ pip_install_systemwide_location }}"
    executable: "{{ pip_install_systemwide_executable | default(omit) }}"
  with_items: "{{ pip_install_systemwide_packages | default([], true) }}"
  tags: molecule-idempotence-notest
