---
- name: Add custom systemwide pip path to each user's path for installing global packages.
  copy:
    dest: "/etc/profile.d/{{ custom_pip_path_profile }}"
    content: |
      export PYTHONPATH="{{ custom_pip_path }}${PYTHONPATH:+:${PYTHONPATH}}"
      export PATH="{{ custom_pip_path }}/bin${PATH:+:${PATH}}"

- name: Install packages
  pip:
    name: "{{ item }}"
    extra_args: "--target {{ custom_pip_path }}"
    executable: "{{ pip_install_systemwide_executable | default(omit) }}"
  with_items: "{{ pip_install_systemwide_packages | default([], true) }}"
  tags: molecule-idempotence-notest
