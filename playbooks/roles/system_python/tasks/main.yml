---
- name: Set latest system python fact
  set_fact:
   system_python_latest: "{{ system_python_latest_versions[ansible_distribution][ansible_distribution_version] | default('') }}"

- name: Fail if no latest python version for this OS is defined
  fail:
    msg: "Trying to install latest python fot the system, but no latest python version for {{ ansible_distribution }} {{ ansible_distribution_version }} is defined."
  when: system_python_latest | length == 0

- name: Install latest system python for Ubuntu
  when: ansible_distribution == "Ubuntu"
  block:

    - name: Install latest system python and corresponding venv
      package:
        name: "{{ item }}"
        state: present
      with_items:
        - "python{{ system_python_latest }}"
        - "python{{ system_python_latest }}-venv"

    - name: Set path to latest system python
      set_fact:
        system_python_path: "/usr/bin/python{{ system_python_latest }}"

    - name: Check if pip for new version is already installed
      stat:
        path: "/usr/local/bin/pip{{ system_python_latest }}"
      register: "_pip_check"

    - name: Install pip for new version
      when: not _pip_check.stat.exists
      shell: "curl -sS  {{ system_python_get_pip_url }} | {{ system_python_path }}"
