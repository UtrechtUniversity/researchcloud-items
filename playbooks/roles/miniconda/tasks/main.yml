---
- name: Create miniconda multi-user group and add new users to it automatically
  ansible.builtin.include_role:
    name: default_group
  vars:
    default_group_group:
      groupname: "{{ miniconda_groupname }}"

# The get_url ansible module in the task below does not create a directory
- name: Ensure download dir exists
  ansible.builtin.file:
    path: "{{ miniconda_download_dest }}"
    state: directory
    mode: "0755"

- name: Download miniconda installation files
  ansible.builtin.get_url:
    url: "{{ miniconda_url }}"
    dest: "{{ miniconda_download_dest }}/{{ miniconda_install_script }}"
    mode: "0755"

- name: Install system-wide
  ansible.builtin.include_tasks: install_system.yml

- name: Place runonce script to init conda for each user
  when: miniconda_auto_init | bool
  ansible.builtin.template:
    src: runonce_conda.sh.j2
    dest: /etc/runonce.d/runonce_conda.sh
    mode: "0750"
