---
# Following the instructions on https://docs.anaconda.com/anaconda/install/linux/, gathered in May 2022.

# # commented out to first try to install it without these dependencies.
# - name: Install dependencies
#   include_task: "dependencies_{{ ansible_pkg_mgr }}.yml"

- name: Ensure download dir exists
  file:
    path: " {{ item }}"
    state: directory
  with_items:
    - "/usr/share/desktop-directories/" #xdg-desktop-menu bug requires manually creating this directory.
    - "{{ anaconda_download_dest }}/" #ansible get_url-module does not create directories. 

- name: Download anaconda installation files
  get_url:
    url: "{{ anaconda_url }}"
    dest: "{{ anaconda_download_dest }}/"
    mode: 0774

- name: Install anaconda for every user
  become_user: "{{ item.user }}"
  command:
    cmd: "{{ anaconda_download_dest }}/{{ anaconda_file }} -b -p {{ anaconda_install_dir }}"
    creates: "{{ anaconda_install_dir }}"
  with_items:
    - "{{ fact_regular_users }}"

- name: Install desktop file menu item through role
  include_role:
    name: desktop_file
  vars: 
    app_name: anaconda
    sizes:
      - 48
      - 64
      - 96
...
