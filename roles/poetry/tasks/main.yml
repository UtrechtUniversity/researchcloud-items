---
- name: Check if poetry is installed
  command: "{{ ansible_env.HOME }}/.local/bin/poetry"
  register: poetry_cmd
  changed_when: false
  ignore_errors: true

- name: Download poetry installer
  get_url:
    url: https://raw.githubusercontent.com/python-poetry/poetry/master/install-poetry.py
    dest: "{{ ansible_env.HOME }}/install-poetry.py"
    mode: "0400"
    timeout: 20
  when: poetry_cmd is failed

- name: Install poetry
  command: "python3 {{ ansible_env.HOME }}/install-poetry.py"
  notify: delete poetry installer 
  when: poetry_cmd is failed
...