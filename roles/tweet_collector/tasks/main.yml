---
- name: Checkout tweet collector repository.
  git:
    repo: https://github.com/SytseGroenwold/tweet_collector.git
    dest: /opt/tweet_collector
    version: remove-sh 

- name: Ensure virtualenvwhich is installed
  pip:
    name: virtualenv
    state: present

- name: Create virtualenv to install tweet_collector into.
  command: virtualenv /opt/venvs/tweet_collector

- name: Build tweet_collector to install through pip later
  shell:
    cmd: /opt/poetry/bin/poetry build
  chdir: /opt/tweet_collector

- name: Install tweet_collector through pip
  pip:
    name: /opt/tweet_collector/dist/tweet_collector*.whl
    virtualenv: /opt/venvs/tweet_collector
    virtual_command: virtualenv

# - name: Install tweet collector through poetry
#   shell:
#     cmd: |
#       source /opt/venvs/tweet_collector/bin/activate
#       /opt/poetry/bin/poetry install
#     chdir: /opt/tweet_collector

- name: Create function that launches virtualenv before launching tweet_collector
  copy:
    src: set_tweetcollector_alias
    dest: /etc/runonce.d
    mode: 0755
...
