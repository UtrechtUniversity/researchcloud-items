---
- name: Checkout tweet collector repository.
  git:
    repo: https://github.com/UtrechtUniversity/tweet_collector.git
    dest: /opt/tweet_collector

- name: Ensure virtualenvwhich is installed
  pip:
    name: virtualenv
    state: present

- name: Create virtualenv to install tweet_collector into.
  pip:
    virtualenv: /opt/venvs/tweet_collector
    virtualenv_command: virtualenv

- name: Install tweet collector through poetry
  shell:
    cmd: |
      source /opt/venvs/tweet_collector/bin/activate
      /opt/poetry/bin/poetry install
    chdir: /opt/tweet_collector

- name: Create function that launches virtualenv before launching tweet_collector
  copy:
    src: set_tweetcollector_alias
    dest: /etc/runonce.d
    mode: 0755
...
