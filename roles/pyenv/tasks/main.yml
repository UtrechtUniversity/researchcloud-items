---
- name: Install pyenv system-wide
  when: system_wide
  apt:
    name: python3.8-venv
    state: present  

# Taken from https://github.com/pyenv/pyenv/wiki#suggested-build-environment
- name: install pyenv dependencies, yum package manager
  package:
    name: "{{ item }}"
    state: present
  with_items:
    # Keep in alphabetical order
    - bzip2
    - bzip2-devel
    - gcc
    - libffi-devel
    - openssl-devel
    - readline-devel
    - sqlite
    - sqlite-devel
    - tk-devel
    - xz-devel
    - zlib-devel
  when: ansible_pkg_mgr == 'yum'

- name: install pyenv dependencies, apt package manager
  package:
    name: "{{item}}"
    state: present
  with_items:
    # Keep in alphabetical order
    - build-essential 
    - curl
    - libbz2-dev
    - libffi-dev
    - libreadline-dev
    - liblzma-dev
    - libncursesw5-dev
    - libssl-dev
    - libsqlite3-dev
    - libxml2-dev
    - libxmlsec1-dev
    - llvm
    - make 
    - tk-dev
    - wget 
    - xz-utils
    - zlib1g-dev
  when: ansible_pkg_mgr == 'apt'

- name: add pyenv install to runonce config
  copy:
    src: "pyenv-install.sh"
    dest: "/etc/runonce.d/01_pyenv-install.sh"
    mode: 0755

#TODO: refactor this to install per user the same was as poetry is done. 
...